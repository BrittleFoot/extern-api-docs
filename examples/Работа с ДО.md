После отправки черновика мы получаем идентификатор документооборота (id). В этом примере рассмотрим, как по id получить документооборот и работать с ним дальше. Пример касается документооборота ФНС типа Декларация.

## Порядок работы
Ниже представлена схема прохождения данного типа документооборота

![Схема](https://github.com/skbkontur/extern-api-docs/blob/master/images/dc_example4.jpg)

1. Запрашиваем статус документооборота. Это можно делать двумя способами: запрашивать периодически конкретный документооборот, запомнив его id при отправке черновика, запрашивать список документооборотов своей учетной записи (предпотчительный вариант):
      - статус "Отправлен" означает, что изменений в документообороте после отправке черновика ещё не произошло, никаких действий не требуется
      - статус "Доставлен" означает, что документ дошел до ФНС и принят в работу, в документообороте при этом появится новый документ извещение о получении, никаких действий не требуется
      - статус "Ответ обработан" означает, что на отправленный документооборот пришли результаты приема.  
2. Получили результаты приема, формируем извещения о получении на них:
      - пришло уведомление об отказе, на него необходимо в ответ в инспекцию направить извещение о получении; после этого документооборот считается завершенным; отправленный документ ФНС не приняла; необходимо прочитать причины отказа в уведомлении, исправить их и отправить документ заново, создав новый черновик.  
      - пришла квитанция о приеме, на неё необходимо в ответ в инспекцию направить извещение о получении; отправленный документ ФНС приняла и приступила к его проверке.  
3. Вновь запрашиваем статус документооборота, и ждем его изменения на "Получен ответ"  
4. Статус "Получен ответ" означает, что на документ пришли результаты обработки: либо извещение о вводе, либо уведомление об уточнении. На них необходимо в ответ в инспекцию направить извещение о получении. После этого документооборот считается завершенным. Если пришло уведомление об уточнении, то необходимо исправить недочеты, указанные в уведомлении, исправить их и отправить корректировку, создав новый черновик.

По сути вся работа с документооборотом сводится к двум моментам:
* следить за статусом незавершенных документооборотов;
* при необходимости отправлять ответные документы.

## 1. Запрашиваем статус документооборота
Данный процесс можно организовать двумя методами:

* Метод: GET DocflowAsync ([swagger](http://extern-api.testkontur.ru/swagger/ui/index#!/Docflows/Docflows_GetDocflowAsync), [docs](https://github.com/skbkontur/extern-api-docs/blob/master/Работа%20с%20ДО.md#get-dc).

   В цикле запрашиваем документооборот, оптимальным периодом запроса можно считать 1 час, изменения в документообороте не происходят часто. В результате работы метода содержится вся актуальная информация по документообороту, в том числе и его статус.

*Запрос*: 
```
```
*Тело*:
```
```
*Ответ*:
```
```

* Метод: GET DocflowsAsync ([swagger](http://extern-api.testkontur.ru/swagger/ui/index#!/Docflows/Docflows_GetDocflowsAsync), [docs](https://github.com/skbkontur/extern-api-docs/blob/master/Работа%20с%20ДО.md#get-dcs).

   В результате работы этого метода мы получаем список всех документооборотов учетной записи, у каждого документооборота в списке будет мета-информация о нем, в том числе и его статус. А можно заранее, задав фильтр в списке по статусу, выбирать документообороты только нужного статуса.

*Запрос*: 
```
```
*Тело*:
```
```
*Ответ*:
```
```

## 2. Формирование извещения о получении на результаты приема
Для этого необходимо воспользоваться последовательностью методов:
* Метод: GET ReplyDocumentAsync ([swagger](http://extern-api.testkontur.ru/swagger/ui/index#!/Docflows/Docflows_GetReplyDocumentAsync),[docs](https://github.com/skbkontur/extern-api-docs/blod/master/Работа%20с%20ДО.md#get-reply-doc)).
* Метод: POST ReplyDocumentAsync ([swagger](http://extern-api.testkontur.ru/swagger/ui/index#!/Docflows/Docflows_SendReplyDocumentAsync),[docs](https://github.com/skbkontur/extern-api-docs/blod/master/Работа%20с%20ДО.md#post-reply-doc)).

Сначала с помощью метода GET ReplyDocumentAsync получаем xml-файл извещения о получении, подписываем его и методом POST ReplyDocumentAsync отправляем в ФНС.

GET ReplyDocumentAsync  
*Запрос*: 
```
```
*Тело*:
```
```
*Ответ*:
```
```

POST ReplyDocumentAsync  
*Запрос*: 
```
```
*Тело*:
```
```
*Ответ*:
```
```

## 3. Ожидание результатов обработки
Работаем аналогично п.1

## 4. Формирование извещения о получении на результаты обработки
Работаем аналогично п.2

-----

## Печать документов
Метод: GET DocumentPrintAsync ([swagger](http://extern-api.testkontur.ru/swagger/ui/index#!/Docflows/Docflows_GetDocumentPrintAsync), [docs](https://github.com/skbkontur/extern-api-docs/blob/master/Работа%20с%20ДО.md#get-print-doc)).

Также в любой момент времени можно получить печатную форму любого формализованного документа в документообороте.

*Запрос*: 
```
```
*Тело*:
```
```
*Ответ*:
```
```

-----

**Другие примеры**

