Разберем пример, когда организация сдаёт отчетность о среднесписочной численности сама за себя - то есть одновременно является и отправителем, и налогоплательщиком. Для работы примера необходимо получить тестовые данные, написав нам по адресу extern-api@skbkontur.ru. В письме необходимо указать наименование и ИНН вашей организации, кратко описать суть вашей деятельности и планируемые сценарии использования API Контур.Экстерна.

### Данные необходимые для работы примера

* файл декларации о среднесписочной численности 
```
<?xml version="1.0" encoding="windows-1251"?>
<Файл ИдФайл="NO_SRCHIS_0000_0000_5845661249170650801_20160909_d0cc4da7-a9a8-407a-97ac-93ceff1cdff0" ВерсФорм="4.01" ТипИнф="СВЕДСРСПИСЧИСЛ" ВерсПрог="КОНТУР-ЭКСТЕРН, ВЕРСИЯ 11.0" КолДок="1">
<ИдОтпр>
<ФИООтв Фамилия="Петров" Имя="Георгий" Отчество="Робертович" />
</ИдОтпр>
<Документ ИдДок="d0cc4da7-a9a8-407a-97ac-93ceff1cdff0">
<СвНП>
<НПЮЛ НаимОрг="mainOrgNamePAO" ИННЮЛ="5845661249" КПП="170650801">
<СвРукОрг Фамилия="Петров" Имя="Георгий" Отчество="Робертович" />
</НПЮЛ>
</СвНП>
<ОписПерСвед КНД="1110018" ДатаДок="09.09.2013" />
<СодПерСвед ДатаСредСпЧисл="01.01.2013" КолЧел="500" />
</Документ>
</Файл>
```
* api-key - [api-key](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/api-key.md)
* inn - ИНН тестовой учетной записи
* kpp - КПП тестовой учетной записи
* certificate - тестовый сертификат ЭП тестовой учетной записи
* ifns-code - код инспекции ФНС, на тестовой площадке у нас работают 2 инспекции, которые автоматически отвечают на отправленные документы (0087 - приходят положительные ответы, 0088 - приходят отрицательные ответы)

### Порядок работы

Предполагаем, что учетные данные организации уже заведены.    
1. Аутентифицируемся, получая [auth.sid](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/auth.sid.md).
2. Получаем accountId своей учетной записи Контур.Экстерна в тестовой среде.
3. Создаем черновик документооборота, наполняя его минимально необходимыми данными:
* ИНН-КПП отправителя;
* сертификат, который используется для подписи;
* ip-адрес рабочего места абонента (необходимо для предоставления в ФНС);
* код инспекции ФНС, куда направляется декларация;
* ИНН-КПП организации, за которую происходит отправка декларации (в нашем случае совпадают с ИНН-КПП отправителя).
4. Записываем в черновик декларацию и подпись (контент в base64).
5. Отправляем документы из черновика в ФНС.
 
## 1. Аутентификация  
Получаем [auth.sid](https://github.com/skbkontur/extern-api-docs/blob/master/manuals/auth.sid.md). Например, используя метод аутентификации по сертификату [→](https://github.com/skbkontur/extern-api-docs/blob/master/examples/Аутентификация.md#1)

**Инициализация**
*Запрос*: 
```
POST /auth/v5.9/authenticate-by-cert?free=true&apiKey=5D8E8EF1-DA66-480C-9BAA-032AEFDD5687 HTTP/1.1
```
*Тело*:
```
-----BEGIN CERTIFICATE-----
MIIJTzCCCP6gAwIBAgIKLUfNEQAAAAKeZjAIBgYqhQMCAgMwggFbMRgwFgYFKoUD
...
ig6Wya0ui9H9fTASUKfeJoOHE6u01whF06AZ3YrAMkluO1E=
-----END CERTIFICATE-----
```
*Ответ*:
```
HTTP/1.1 200 OK 
Content-Type: application/json;charset=UTF-8 
Content-Length: xxxx 
Server: xxxx 

{
"EncryptedKey": "MIIDigYJKoZIhvcNAQcDoIIDezCCA3cCAQAxggI+MII ... CRV6wnPTXyfIgIvttB5pXzwwWVE/6pdw==",
"Link":
{
"Rel":"Send decrypted key to this link",
"Href":"https://api.dev.kontur/auth/v5/approve-cert?thumbprint=53AC6B8A92C13C651E7EF5AD7E22916D8E7FAAAA"
}
}
```
**Подтверждение**
*Запрос*: 
```
POST /auth/v5.9/approve-cert?thumbprint=‎dbfb548333da2ff5277b06e119248ec03106c14d&apiKey=5D8E8EF1-DA66-480C-9BAA-032AEFDD5687 HTTP/1.1
```
*Тело*:
```
{
3082 03a7 0609 2a86 4886 f70d 0107 03a0
8203 9830 8203 9402 0100 3182 025b 3082
...
9ec7 b7a0 8470 f271 2a11 d1c8 007e be42
b128 17d1 852b 8edf de3f 7b
}
```
*Ответ*:
```
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Content-Length: xxxx
Server: xxxx
```

## 2. Получение accountId
Метод: [GET All](http://extern-api.testkontur.ru/swagger/ui/index#!/Accounts/Accounts_GetAll)

*Запрос*: 
```

```
*Тело*:

*Ответ*:
```
```

## 3. Создание черновика документооборота  
Метод: [POST Draft](http://extern-api.testkontur.ru/swagger/ui/index#!/Drafts/Drafts_Create)

При сдаче отчетности за себя, sender совпадает с organization. Указывать необходимо оба параметра.

*Запрос*: 
```

```
*Тело*:
```
{ "sender": {
  "inn": "хххххххххх",
  "kpp": "ххххххххх",
  "certificate": {
  "content": "MIIJijCCCTmgAw......"
  },
  "ipaddress": "8.8.8.8"
  },
  "recipient": {
  "ifns-code": "хххх"
  },
  "organization": {
  "inn": "хххххххххх",
  "organization": {
  "kpp": "ххххххххх"
  }
  }
}
```
*Ответ*:
```
```
  
#### 3. Добавление документов  

Метод: [POST Document](http://extern-api.testkontur.ru/swagger/ui/index#!/Drafts/DraftDocuments_AddDocument)

На этом этапе добавляем в черновик документооборота необходимые документы. Добавим декларацию со сведениями о среднесписочной численности. В этом же запросе добавим подпись.

*Запрос*: 
```

```
*Тело*:
```
{
  "base64-content": "PD94bWwgdmVyc2l.....",
  "signature": "MIINyAYJKoZIhvcNAQcC....",
  "description": { }
}
```
*Ответ*:
```
```


#### 4. Отправка  

Метод: [POST Send](http://extern-api.testkontur.ru/swagger/ui/index#!/Drafts/Drafts_Send)
*Запрос*: 
```

```
*Тело*:
```

```
*Ответ*:
```
```
------

**Другие примеры**

- [Отправитель и налогоплательщик разные лица, прикладывается несколько документов, возникает ошибка при отправке]
- [Отправка с поэтапным прохождением проверки и подготовки, падение при подготовке]
- [Работа со списком документооборотов, применение фильтров]
- [Работа с отдельным документооборотом]
